# Dexter NGINX Overview

## Live Config Backups (see `ops/nginx-sites/`)
- `dexter.cash.conf` – primary site plus MCP/OAuth proxy rules and pump dashboard
- `api.dexter.cash.conf` – REST/GraphQL API reverse proxy on :3030
- `mcp.dexter.cash.conf` – dedicated MCP HTTP proxy on :3930

These files are pulled directly from `/etc/nginx/sites-enabled/` whenever we refresh them.  Update the copies after making changes in production so the repo stays authoritative.

## Legacy Alpha Split Example

# FE: dexter.cash -> Next.js on :3017 (or Vercel if you prefer)
server {
  listen 443 ssl http2;
  server_name dexter.cash;
  # ssl_certificate ...;
  # ssl_certificate_key ...;

  location / {
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    proxy_pass http://127.0.0.1:43017;
  }
}

# API: api.dexter.cash -> dexter-api on :3030
server {
  listen 443 ssl http2;
  server_name api.dexter.cash;

  location / {
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    proxy_pass http://127.0.0.1:3030;
  }
}

# MCP: mcp.dexter.cash -> existing dexter-mcp (Streamable HTTP) on :3930
server {
  listen 443 ssl http2;
  server_name mcp.dexter.cash;

  location / {
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    proxy_pass http://127.0.0.1:3930;
  }
}

# Alternate: single-domain path-based (no new subdomains)
# - Keep dexter.cash for FE
# - Proxy /api/* -> :3030 and /mcp/* -> :3930
# Example server block additions:
#   location /api/ {
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto https;
#     proxy_pass http://127.0.0.1:3030/;
#   }
#   location /mcp/ {
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto https;
#     proxy_pass http://127.0.0.1:3930/;
#   }
